import cv2
import numpy as np

# 1) Load her image (use r"" so Windows path works)
image_path = r"D:\root\Thinture\old laptop\jothiesh\her\code\image-processing-project\girlfriend.jpeg"
img = cv2.imread(image_path)

if img is None:
    raise FileNotFoundError(f"Could not load image at {image_path}")

# 2) Resize (optional) if image is huge
max_width = 900
h, w = img.shape[:2]
if w > max_width:
    scale = max_width / w
    img = cv2.resize(img, (int(w * scale), int(h * scale)), interpolation=cv2.INTER_AREA)

# 3) Create pencil sketch (realistic drawing look)
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
inv = 255 - gray
blur = cv2.GaussianBlur(inv, (21, 21), 0)

# Dodge blend: sketch = gray * 255 / (255 - blur)
blend = 255 - blur
blend[blend == 0] = 1  # avoid division by zero
sketch = (gray * 255 / blend)
sketch = np.clip(sketch, 0, 255).astype("uint8")

# Convert sketch back to BGR so we can draw colored text on it
sketch_bgr = cv2.cvtColor(sketch, cv2.COLOR_GRAY2BGR)

# 4) Add birthday text
text = "Happy Birthday, my love"
font = cv2.FONT_HERSHEY_SCRIPT_SIMPLEX  # more handwritten feel
font_scale = 1.2
thickness = 2

text_size, _ = cv2.getTextSize(text, font, font_scale, thickness)
text_w, text_h = text_size

H, W = sketch_bgr.shape[:2]
x = (W - text_w) // 2
y = H - 40  # a bit above bottom

# Shadow for readability
cv2.putText(sketch_bgr, text, (x + 2, y + 2), font,
            font_scale, (0, 0, 0), thickness + 1, cv2.LINE_AA)

# Main text (dark gray)
cv2.putText(sketch_bgr, text, (x, y), font,
            font_scale, (40, 40, 40), thickness, cv2.LINE_AA)

# 5) Show and save result
cv2.imshow("Birthday Sketch", sketch_bgr)
cv2.imwrite("girlfriend_birthday_sketch.png", sketch_bgr)

print("Saved as girlfriend_birthday_sketch.png")
cv2.waitKey(0)
cv2.destroyAllWindows()